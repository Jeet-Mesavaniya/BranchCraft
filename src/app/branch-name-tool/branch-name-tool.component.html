<div class="tool-container">
  <form #branchForm="ngForm" (ngSubmit)="generateBranch()">
    <!-- Team -->
    <div class="form-group">
      <label>Team</label>
      <input [(ngModel)]="team" name="team" #teamCtrl="ngModel" required />
      @if (teamCtrl.invalid && teamCtrl.touched) {
        <div class="error-text">Team is required.</div>
      }
    </div>

    <!-- PI -->
    <div class="form-group">
      <label>PI</label>
      <input [(ngModel)]="pi" name="pi" #piCtrl="ngModel" required />
      @if (piCtrl.invalid && piCtrl.touched) {
        <div class="error-text">PI is required.</div>
      }
    </div>

    <!-- Sprint -->
    <div class="form-group">
      <label>Sprint</label>
      <select [(ngModel)]="sprint" name="sprint" #sprintCtrl="ngModel" required>
        <option value="">-- Select Sprint --</option>
        <option value="1">Sprint 1</option>
        <option value="2">Sprint 2</option>
        <option value="3">Sprint 3</option>
      </select>
      @if (sprintCtrl.invalid && sprintCtrl.touched) {
        <div class="error-text">Sprint is required.</div>
      }
    </div>

    <!-- Work Item -->
    <div class="form-group">
      <label>Work Item</label>
      <textarea
        [(ngModel)]="workItemText"
        name="workItemText"
        #workCtrl="ngModel"
        required
        rows="3"
        placeholder="Paste like: Bug 1312345 : Unnecessary Pop-up Displayed ..."
      ></textarea>
      @if (workCtrl.invalid && workCtrl.touched) {
        <div class="error-text">Work Item is required.</div>
      }
    </div>

    <!-- Generate -->
    <button class="generate-btn" type="submit" [disabled]="branchForm.invalid">
      üöÄ Generate Branch
    </button>
    @if (invalidInput) {
    <div style="color:red; margin-top:5px;">
      Please fill in all required fields.
    </div>
  }
  </form>

  <!-- Result -->
  @if (branchName) {
    <div class="result-box animate-slide-up">
      <p>
        <b><i class="fas fa-terminal"></i> Branch: </b>
        <span>{{ branchName }}</span>
      </p>

      <!-- ‚úÖ Character Counter -->
      <p class="char-count">{{ branchName.length }} / {{ maxLength }} chars</p>

      @if (wasTruncated) {
        <p class="warning-text">
          ‚ö†Ô∏è Branch name was truncated to {{ maxLength }} characters.
        </p>
      }

      <!-- ‚úÖ Copy options -->
      <div class="btn-row">
        <button class="copy-btn" (click)="copy(branchName, '‚úÖ Branch copied!')">
          <i class="fas fa-copy"></i> Copy Branch
        </button>
        <button
          class="copy-btn git-btn"
          (click)="copy('git branch ' + branchName, '‚úÖ Git branch command copied!')"
        >
          <i class="fab fa-git-alt"></i> Copy Git Create
        </button>
        <button
          class="copy-btn git-btn"
          (click)="copy('git checkout -b ' + branchName, '‚úÖ Git checkout command copied!')"
        >
          <i class="fab fa-git-alt"></i> Copy Git Checkout
        </button>
      </div>

      @if (copyMessage) {
        <p class="copy-success">{{ copyMessage }}</p>
      }
    </div>
  }

  <!-- ‚úÖ History -->
  @if (history.length > 0) {
    <div class="history-box animate-slide-up">
      <h3><i class="fas fa-history"></i> Recent Branches</h3>
      <ul>
        @for (item of history; track $index) {
          <li>
            <span class="branch-text">{{ item }}</span>
            <button
              class="history-copy-btn"
              (click)="copy(item, '‚úÖ Branch copied!')"
            >
              <i class="fas fa-copy"></i> Copy
            </button>
          </li>
        }
      </ul>
    </div>
  }
</div>
